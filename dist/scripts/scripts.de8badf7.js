"use strict";window.URL="http://preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com/public",angular.module("seedApp",["ngAnimate","ngMessages","ngResource","ngSanitize","ngTouch","ui.router","satellizer","ngTable","platanus.rut","ui.mask","jlareau.pnotify","blockUI","ngTagsInput","angucomplete-alt","ngFileUpload","ui.select","brantwills.paging","angularMoment","ui.bootstrap.tabs","ui.bootstrap.collapse"]).config(["$stateProvider","$urlRouterProvider","$authProvider","notificationServiceProvider","blockUIConfig",function(a,b,c,d,e){a.state("home",{"abstract":!0,templateUrl:"/views/home.html",controller:"HomeCtrl"}).state("home.main",{url:"/",templateUrl:"/views/main.html",controller:"MainCtrl"}),a.state("login",{url:"/login",templateUrl:"/views/auth/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout",template:null,controller:"LogoutCtrl"}),a.state("home.forbidden",{url:"/forbidden",templateUrl:"/views/forbidden.html"}),a.state("home.trabajadores",{url:"/trabajadores",templateUrl:"/views/trabajador/lista.html",controller:"TrabajadorCtrl"}).state("home.nuevoTrabajador",{url:"/trabajadores/nuevo",templateUrl:"/views/trabajador/detalle.html",controller:"DetalletrabajadorCtrl"}).state("home.detalleTrabajador",{url:"/trabajadores/detalle/:id",templateUrl:"/views/trabajador/detalle.html",controller:"DetalletrabajadorCtrl"}),a.state("home.empresas",{url:"/empresas",templateUrl:"/views/empresa/lista.html",controller:"EmpresaCtrl"}).state("home.nuevaEmpresa",{url:"/empresas/nueva",templateUrl:"/views/empresa/detalle.html",controller:"DetalleempresaCtrl"}).state("home.detalleEmpresa",{url:"/empresas/detalle/:id",templateUrl:"/views/empresa/detalle.html",controller:"DetalleempresaCtrl"}),a.state("home.usuarios",{url:"/usuarios",templateUrl:"/views/usuario/lista.html",controller:"UsuarioCtrl"}).state("home.nuevoUsuario",{url:"/usuarios/nuevo",templateUrl:"/views/usuario/detalle.html",controller:"DetalleusuarioCtrl"}).state("home.detalleUsuario",{url:"/usuarios/detalle/:id",templateUrl:"/views/usuario/detalle.html",controller:"DetalleusuarioCtrl"}),a.state("home.contratos",{url:"/contratos",templateUrl:"/views/contrato/lista.html",controller:"ContratoCtrl"}).state("home.nuevoContrato",{url:"/contratos/nuevo",templateUrl:"/views/contrato/detalle.html",controller:"DetallecontratoCtrl"}).state("home.detalleContrato",{url:"/contratos/detalle/:id",templateUrl:"/views/contrato/detalle.html",controller:"DetallecontratoCtrl"}).state("home.contratistasContrato",{url:"/contratos/detalle/:id/contratistas",templateUrl:"/views/contrato/contratistas.html",controller:"ContratistascontratoCtrl"}),a.state("home.evaluaciones",{url:"/evaluaciones",templateUrl:"/views/evaluacion/lista.html",controller:"EvaluacionCtrl"}).state("home.nuevaEvaluacion",{url:"/evaluaciones/nuevo",templateUrl:"/views/evaluacion/detalle.html",controller:"DetalleevaluacionCtrl"}).state("home.detalleEvaluacion",{url:"/evaluaciones/detalle/:id",templateUrl:"/views/evaluacion/detalle.html",controller:"DetalleevaluacionCtrl"}).state("home.requisitosEvaluacion",{url:"/evaluaciones/detalle/:id/requisitos",templateUrl:"/views/evaluacion/requisitos.html",controller:"RequisitosevaluacionCtrl"}).state("home.habilitacionesEvaluacion",{url:"/evaluaciones/detalle/:id/habilitaciones",templateUrl:"/views/evaluacion/habilitaciones.html",controller:"HabilitacionesevaluacionCtrl"}),a.state("home.licencias",{url:"/licencias",templateUrl:"/views/licencia/lista.html",controller:"LicenciaCtrl"}),a.state("home.resumen",{url:"/resumen/:id",templateUrl:"/views/resumen/vista1.html",controller:"ResumenCtrl"}).state("home.informeEvaluacion",{url:"/informe/:id",templateUrl:"/views/resumen/vista2.html",controller:"ResumenCtrl"}),b.otherwise("/"),c.loginRedirect="/",c.logoutRedirect="/",c.signupRedirect="/login",c.loginUrl=window.URL+"/auth/login",c.signupUrl=window.URL+"/auth/register",c.loginRoute="/login",c.signupRoute="/register",d.setDefaults({buttons:{closer:!1,sticker:!1}}),e.message="Cargando, por favor espere...",e.requestFilter=function(a){return"DELETE"===a.method?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/empresa\/buscar/)?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/faena\/buscar/)?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/licencia\/buscar/)?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/contrato\/buscar/)?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/faena_contratista\/buscar/)?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/evaluacion\/[0-9]\/requisitos/)?!1:a.url.match(/http:\/\/preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com\/public\/habilidad\/buscar/)?!1:void 0}}]).run(["$rootScope","$state","$auth","Role","amMoment",function(a,b,c,d,e){a.$on("$stateChangeStart",function(a,e){if("login"!==e.name)if(c.isAuthenticated())if("login"===e.name)a.preventDefault(),b.go("home.main");else{var f=d.get();switch(e.data&&-1!==e.data.denegados.indexOf(f)&&(a.preventDefault(),b.go("home.forbidden")),f){case 4:"home.resumen"!==e.name&&b.go("home.resumen")}}else a.preventDefault(),b.go("login")}),e.changeLocale("es")}]),angular.module("seedApp").controller("HomeCtrl",["$scope","$http","$state",function(a,b,c){a.$state=c,a.smallMenu=!1,a.isCollapsed=!0,a.menuOpen={empresas:!1},a.verSubmenu=function(b){a.menuOpen={},a.menuOpen[b]=!a.menuOpen[b]}}]),angular.module("seedApp").controller("MainCtrl",["$scope","Evaluacion",function(a,b){function c(){var c=b.query({type:"resumen",page:a.paginaActual,count:a.cantidadPagina,sorting:"desc"});c.$promise.then(function(b){a.evaluaciones=b.data,a.total=b.total})}a.rutaBase=window.URL+"/adjuntos/trabajadores/",a.paginaActual=1,a.cantidadPagina=3,c(),a.pagina=function(b){a.paginaActual=b,c()}}]),angular.module("seedApp").controller("LoginCtrl",["$scope","$auth","$state",function(a,b){a.login=function(){b.login({email:a.user.email,password:a.user.password}).then(function(){})}}]),angular.module("seedApp").controller("RegisterCtrl",["$scope","$auth","$state",function(a,b){a.register=function(){b.signup({email:a.user.email,password:a.user.password,confirmPassword:a.user.confirmPassword}).then(function(){})}}]),angular.module("seedApp").controller("LogoutCtrl",["$scope","$auth","$state",function(a,b){b.logout().then(function(){console.log("logout")})}]),angular.module("seedApp").controller("TrabajadorCtrl",["$scope","ngTableParams","Trabajador","notificationService","$timeout","Role",function(a,b,c,d,e,f){function g(b){var f=new c({id:b});f.$delete(function(b){b?(d.notifyWithDefaults({title:"Trabajador eliminado",text:"El trabajador fue eliminado correctamente",type:"success"}),e(function(){a.tableParams.reload()},1e3)):d.notifyWithDefaults({title:"Ha ocurrido un error",text:"Intente eliminar el trabajador nuevamente.",type:"error"})})}a.tipoUsuario=f.get(),a.tableParams=new b({page:1,count:10,sorting:{nombres:"desc"}},{total:0,getData:function(a,b){var d=b.url(),e=c.query(d);e.$promise.then(function(c){b.total(c.total),a.resolve(c.data)})}}),a.borrar=function(a){d.notifyWithDefaults({title:"¿Borrar el trabajador seleccionado?",text:"Esta seguro que desea borrar el trabajador seleccionado?",type:"error",confirm:{confirm:!0,buttons:[{text:"Ok",click:function(b,c){b.remove(),b.get().trigger("pnotify.confirm",[b,c]),g(a)}}]}})}}]),angular.module("seedApp").controller("DetalletrabajadorCtrl",["$scope","$http","$stateParams","Trabajador","notificationService","$location",function(a,b,c,d,e,f){a.submitted=!1,a.empresaValida=!0,c.id?a.trabajador=d.get({id:c.id},function(){a.empresaSeleccionada=a.trabajador.empresa.id}):(a.trabajador=new d,a.trabajador.sexo="Masculino"),a.guardarTrabajador=function(b){return a.empresaSeleccionada?(a.empresaValida=!0,a.trabajador.empresa=a.empresaSeleccionada.originalObject?a.empresaSeleccionada.originalObject.id:a.empresaSeleccionada,a.submitted=!0,void(b&&(console.log(a.trabajador),a.trabajador.id?a.trabajador.$update(function(b){b?(a.trabajador=b,e.notifyWithDefaults({title:"Datos guardados",text:"Los datos fueron guardados correctamente",type:"success"})):e.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})}):a.trabajador.$save(function(b){console.log(b),b?(a.trabajador=b,e.notifyWithDefaults({title:"Datos guardados",text:"El trabajador ha sido creado con exito.",type:"success"}),f.path("/trabajadores/detalle/"+b.id)):e.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})},function(a){var b="";for(var c in a.data)b=b+" "+a.data[c]+"<br />";console.log(b),e.notifyWithDefaults({title:"Los datos ingresados son incorrectos",text:b,type:"error"})})))):a.empresaValida=!1},a.cargarLicencias=function(a){return b.get(window.URL+"/licencia/buscar?texto="+a)},a.validar=function(b){return a.formularioTrabajador[b].$invalid&&!a.formularioTrabajador[b].$pristine}}]),angular.module("seedApp").controller("EmpresaCtrl",["$scope","ngTableParams","Empresa","notificationService","$timeout",function(a,b,c,d,e){function f(b){var f=new c({id:b});f.$delete(function(b){b?(d.notifyWithDefaults({title:"Empresa eliminada",text:"La empresa fue eliminada correctamente",type:"success"}),e(function(){a.tableParams.reload()},1e3)):d.notifyWithDefaults({title:"Ha ocurrido un error",text:"Intente eliminar la empresa nuevamente.",type:"error"})})}a.tableParams=new b({page:1,count:10,sorting:{razon_social:"desc"}},{total:0,getData:function(a,b){var d=b.url(),e=c.query(d);e.$promise.then(function(c){b.total(c.total),a.resolve(c.data)})}}),a.borrar=function(a){d.notifyWithDefaults({title:"¿Borrar la empresa seleccionada?",text:"Esta seguro que desea borrar la empresa seleccionada?",type:"error",confirm:{confirm:!0,buttons:[{text:"Ok",click:function(b,c){b.remove(),b.get().trigger("pnotify.confirm",[b,c]),f(a)}}]}})}}]),angular.module("seedApp").controller("DetalleempresaCtrl",["$scope","$http","$stateParams","Empresa","notificationService","$location",function(a,b,c,d,e,f){a.submitted=!1,a.empresa=c.id?d.get({id:c.id}):new d,a.guardarEmpresa=function(b){a.submitted=!0,b&&(a.empresa.id?a.empresa.$update(function(b){b?(a.empresa=b,e.notifyWithDefaults({title:"Datos guardados",text:"Los datos fueron guardados correctamente",type:"success"})):e.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})}):a.empresa.$save(function(b){b?(a.empresa=b,e.notifyWithDefaults({title:"Datos guardados",text:"La empresa ha sido creada con exito.",type:"success"}),f.path("/empresas/detalle/"+b.id)):e.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})}))},a.validar=function(b){return a.formularioEmpresa[b].$invalid&&!a.formularioEmpresa[b].$pristine}}]),angular.module("seedApp").service("Trabajador",["$resource",function(a){return a(window.URL+"/trabajador/:id",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1},buscar:{method:"GET",isArray:!1,url:window.URL+"/trabajador/buscar?rut=:rut"}})}]),angular.module("seedApp").service("Empresa",["$resource",function(a){return a(window.URL+"/empresa/:id",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}})}]),angular.module("seedApp").controller("ContratoCtrl",["$scope","ngTableParams","Contrato","notificationService","$timeout",function(a,b,c,d,e){function f(b){var c=new Empresa({id:b});c.$delete(function(b){b?(d.notifyWithDefaults({title:"Empresa eliminada",text:"La empresa fue eliminada correctamente",type:"success"}),e(function(){a.tableParams.reload()},1e3)):d.notifyWithDefaults({title:"Ha ocurrido un error",text:"Intente eliminar la empresa nuevamente.",type:"error"})})}a.tableParams=new b({page:1,count:10,sorting:{denominacion:"desc"}},{total:0,getData:function(a,b){var d=b.url(),e=c.query(d);e.$promise.then(function(c){b.total(c.total),a.resolve(c.data)})}}),a.borrar=function(a){d.notifyWithDefaults({title:"¿Borrar la empresa seleccionada?",text:"Esta seguro que desea borrar la empresa seleccionada?",type:"error",confirm:{confirm:!0,buttons:[{text:"Ok",click:function(b,c){b.remove(),b.get().trigger("pnotify.confirm",[b,c]),f(a)}}]}})}}]),angular.module("seedApp").controller("UsuarioCtrl",["$scope","ngTableParams","Usuario","notificationService","$timeout",function(a,b,c,d,e){function f(b){var f=new c({id:b});f.$delete(function(b){b?(d.notifyWithDefaults({title:"Empresa eliminada",text:"El usuario fue eliminada correctamente",type:"success"}),e(function(){a.tableParams.reload()},1e3)):d.notifyWithDefaults({title:"Ha ocurrido un error",text:"Intente eliminar el usuario nuevamente.",type:"error"})})}a.tableParams=new b({page:1,count:10,sorting:{nombre:"desc"}},{total:0,getData:function(a,b){var d=b.url(),e=c.query(d);e.$promise.then(function(c){b.total(c.total),a.resolve(c.data)})}}),a.borrar=function(a){d.notifyWithDefaults({title:"¿Borrar el usuario seleccionado?",text:"Esta seguro que desea borrar el usuario seleccionado?",type:"error",confirm:{confirm:!0,buttons:[{text:"Ok",click:function(b,c){b.remove(),b.get().trigger("pnotify.confirm",[b,c]),f(a)}}]}})}}]),angular.module("seedApp").controller("DetalleusuarioCtrl",["$scope","$http","$stateParams","Usuario","TipoUsuario","notificationService","$location",function(a,b,c,d,e,f,g){a.submitted=!1,a.tiposUsuario=e.query(),a.usuario=c.id?d.get({id:c.id}):new d,a.guardarUsuario=function(b){a.submitted=!0,b&&(a.usuario.id?a.usuario.$update(function(b){b?(a.usuario=b,f.notifyWithDefaults({title:"Datos guardados",text:"Los datos fueron guardados correctamente",type:"success"})):f.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})}):a.usuario.$save(function(b){b?(a.usuario=b,f.notifyWithDefaults({title:"Datos guardados",text:"El usuario ha sido creado con exito.",type:"success"}),g.path("/usuarios/detalle/"+b.id)):f.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})}))},a.validar=function(b){return a.formularioUsuario[b].$invalid&&!a.formularioUsuario[b].$pristine}}]),angular.module("seedApp").service("Usuario",["$resource",function(a){return a(window.URL+"/usuario/:id",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}})}]),angular.module("seedApp").service("TipoUsuario",["$resource",function(a){return a(window.URL+"/tipo_usuario/:id",{id:"@id"},{query:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!1}})}]),angular.module("seedApp").service("Contrato",["$resource",function(a){return a(window.URL+"/contrato/:id",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1},verFaenasAutorizadas:{method:"GET",params:{id:"@id"},isArray:!0,url:window.URL+"/contrato/:id/faenas_autorizadas"},verContratistas:{method:"GET",params:{id:"@id"},isArray:!0,url:window.URL+"/contrato/:id/contratistas"},guardarContratista:{method:"POST",params:{id:"@id"},isArray:!0,url:window.URL+"/contrato/:id/contratistas"},borrarContratista:{method:"DELETE",params:{id:"@id"},isArray:!0,url:window.URL+"/contrato/:id/contratistas"}})}]),angular.module("seedApp").controller("DetallecontratoCtrl",["$scope","$http","$stateParams","Empresa","Contrato","notificationService","$state",function(a,b,c,d,e,f,g){a.submitted=!1,a.empresaValida=!0,a.dateOptions={format:"yyyy/dd/mm"},a.contrato=c.id?e.get({id:c.id},function(){a.empresaSeleccionada=a.contrato.mandante.id}):new e,a.guardarContrato=function(b){return a.empresaSeleccionada?(a.empresaValida=!0,a.contrato.mandante=a.empresaSeleccionada.originalObject?a.empresaSeleccionada.originalObject.id:a.empresaSeleccionada,a.submitted=!0,void(b&&(a.contrato.id?a.contrato.$update(function(b){b?(a.contrato=b,f.notifyWithDefaults({title:"Datos guardados",text:"Los datos fueron guardados correctamente",type:"success"}),g.go("home.contratistasContrato",{id:b.id})):f.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})}):a.contrato.$save(function(b){b?(a.contrato=b,f.notifyWithDefaults({title:"Datos guardados",text:"El contrato ha sido creado con exito.",type:"success"}),g.go("home.detalleContrato",{id:b.id})):f.notifyWithDefaults({title:"Ocurrió un error",text:"Ocurrio un error al guardar. Intentelo de nuevo.",type:"error"})})))):a.empresaValida=!1},a.cargarFaenas=function(a){return b.get(window.URL+"/faena/buscar?texto="+a)},a.validar=function(b){return a.formularioContrato[b].$invalid&&!a.formularioContrato[b].$pristine}}]),angular.module("seedApp").directive("bDatepicker",function(){return{require:"?ngModel",restrict:"A",link:function(a,b,c,d){var e,f={language:"es",format:"dd/mm/yyyy"};return e=function(c){return b.datepicker("hide"),b.blur(),a.$apply(function(){return d.$setViewValue(c.date)})},null!=d&&(d.$render=function(){if(d.$viewValue){b.datepicker(f).on("changeDate",e);var a=d.$viewValue.split("/");return b.datepicker("update",new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0]))),d.$viewValue}}),c.$observe("bDatepicker",function(){return b.datepicker(f).on("changeDate",e)})}}}),angular.module("seedApp").controller("LicenciaCtrl",["$scope",function(a){a.editable="texto editable"}]),angular.module("seedApp").controller("EvaluacionCtrl",["$scope","ngTableParams","Evaluacion","notificationService","$timeout",function(a,b,c,d,e){function f(b){var c=new Empresa({id:b});c.$delete(function(b){b?(d.notifyWithDefaults({title:"Empresa eliminada",text:"La empresa fue eliminada correctamente",type:"success"}),e(function(){a.tableParams.reload()},1e3)):d.notifyWithDefaults({title:"Ha ocurrido un error",text:"Intente eliminar la empresa nuevamente.",type:"error"})})}a.tableParams=new b({page:1,count:2,sorting:{nombres:"desc"}},{total:0,getData:function(a,b){var d=b.url(),e=c.query(d);e.$promise.then(function(c){b.total(c.total),a.resolve(c.data)})}}),a.borrar=function(a){d.notifyWithDefaults({title:"¿Borrar la empresa seleccionada?",text:"Esta seguro que desea borrar la empresa seleccionada?",type:"error",confirm:{confirm:!0,buttons:[{text:"Ok",click:function(b,c){b.remove(),b.get().trigger("pnotify.confirm",[b,c]),f(a)}}]}})}}]),angular.module("seedApp").controller("DetalleevaluacionCtrl",["$scope","$stateParams","Trabajador","Evaluacion","$http","$state","Toast",function(a,b,c,d,e,f,g){a.submitted=!1,a.empresaValida=!0,a.contratoValido=!0,a.faenasValido=!0,b.id?a.evaluacion=d.get({id:b.id},function(){a.evaluacion.trabajador=a.evaluacion.trabajador,a.empresaSeleccionada=a.evaluacion.trabajador.empresa.id,a.empresaBloqueada=!0,a.contratoSeleccionado=a.evaluacion.contrato.id,a.contratoValido=!0}):(a.evaluacion=new d,a.evaluacion.contrato={},a.evaluacion.trabajador={sexo:"Masculino"}),a.$watch("empresaSeleccionada",function(b){if(b){var c;"string"==typeof b?c=b:"object"==typeof b&&(c=b.originalObject.id),a.queryBuscarContratos="http://preview.snh7fujp32384cxrlmffilcvx3q2rzfrd95a1oi3qlgqr529.box.codeanywhere.com/public/contrato/buscar?type=evaluacion&empresa="+c+"&texto="}}),a.empresaBloqueada=!1,a.buscarTrabajador=function(){a.evaluacion.trabajador&&(a.trabajador=c.buscar({rut:a.evaluacion.trabajador.rut},function(b){b?(a.evaluacion.trabajador=b,a.empresaSeleccionada=a.evaluacion.trabajador.empresa.id,a.empresaBloqueada=!0,a.empresaValida=!0,a.evaluacion.contrato&&(a.evaluacion.contrato.denominacion=""),a.contratoSeleccionado=!1,a.contratoValido=!0,a.evaluacion.faenas=!1):(g.error("El Rut ingresado no corresponde a ningun trabajador","No encontrado"),a.empresaBloqueada=!1)}))},a.cargarFaenas=function(b){var c,d;return"string"==typeof a.empresaSeleccionada?c=a.empresaSeleccionada:"object"==typeof a.empresaSeleccionada&&(c=a.empresaSeleccionada.originalObject.id),"string"==typeof a.contratoSeleccionado?d=a.contratoSeleccionado:"object"==typeof a.contratoSeleccionado&&(d=a.contratoSeleccionado.originalObject.id),e.get(window.URL+"/faena_contratista/buscar?empresa="+c+"&contrato="+d+"&texto="+b)},a.cargarLicencias=function(a){return e.get(window.URL+"/licencia/buscar?texto="+a)},a.guardarEvaluacion=function(b){return a.empresaSeleccionada?a.contratoSeleccionado?0!=!a.evaluacion.faenas.length?(console.log(a.evaluacion.faenas,a.faenasValido),a.faenasValido=!1):(a.empresaValida=!0,a.contratoValido=!0,a.faenasValido=!0,a.evaluacion.trabajador.empresa_id=a.empresaSeleccionada.originalObject?a.empresaSeleccionada.originalObject.id:a.empresaSeleccionada,a.evaluacion.contrato_id=a.contratoSeleccionado.originalObject?a.contratoSeleccionado.originalObject.id:a.contratoSeleccionado,a.submitted=!0,void(b&&(a.evaluacion.id?a.evaluacion.$update(function(a){a?(g.success("Datos guardados","Los datos fueron guardados correctamente"),f.go("home.requisitosEvaluacion",{id:a[0]})):g.error("Ocurrio un error al guardar. Intentelo de nuevo.")}):a.evaluacion.$save(function(a){a?(g.success("Datos guardados","La evaluación ha sido creada con exito."),f.go("home.requisitosEvaluacion",{id:a[0]})):g.error("Ocurrio un error al guardar. Intentelo de nuevo.")},function(a){console.log(a);var b="";for(var c in a.data)b=b+" "+a.data[c]+"<br />";g.error(b)})))):a.contratoValido=!1:a.empresaValida=!1},a.validar=function(b){return a.formularioEvaluacion[b].$invalid&&!a.formularioEvaluacion[b].$pristine}}]),angular.module("seedApp").service("Evaluacion",["$resource",function(a){return a(window.URL+"/evaluacion/:id",{id:"@id"},{query:{method:"GET",isArray:!1},resumen:{method:"GET",isArray:!1,url:window.URL+"/evaluacion/resumen"},update:{method:"PUT",isArray:!1},verRequisitos:{method:"GET",params:{id:"@id"},isArray:!0,url:window.URL+"/evaluacion/:id/requisitos"},guardarRequisito:{method:"POST",params:{id:"@id"},isArray:!0,url:window.URL+"/evaluacion/:id/requisitos"},borrarRequisito:{method:"DELETE",params:{id:"@id"},isArray:!0,url:window.URL+"/evaluacion/:id/requisitos"},verHabilitaciones:{method:"GET",params:{id:"@id",habilitado:!0},isArray:!0,url:window.URL+"/evaluacion/:id/habilitaciones"},verRestricciones:{method:"GET",params:{id:"@id",habilitado:!1},isArray:!0,url:window.URL+"/evaluacion/:id/habilitaciones"},verTodasHabilitaciones:{method:"GET",params:{id:"@id"},isArray:!0,url:window.URL+"/evaluacion/:id/habilitaciones"},guardarHabilitacion:{method:"POST",params:{id:"@id"},isArray:!1,url:window.URL+"/evaluacion/:id/habilitaciones"},borrarHabilitacion:{method:"DELETE",params:{id:"@id"},isArray:!0,url:window.URL+"/evaluacion/:id/habilitaciones/:idHabilitacion"}})}]),angular.module("seedApp").service("Role",["$auth",function(a){return{get:function(){var b=a.getPayload();return parseInt(b.type)}}}]),angular.module("seedApp").controller("ContratistascontratoCtrl",["$scope","$stateParams","Contrato","$http","$state",function(a,b,c,d,e){function f(b){a.faenaActual=b,a.contratistasAutorizados=c.verContratistas({id:a.contrato.id,faena:b})}b.id?a.contrato=c.get({id:b.id},function(){a.faenasAutorizadas=c.verFaenasAutorizadas({id:a.contrato.id},function(){f(a.faenasAutorizadas[0].id)})}):e.go("home.contratos"),a.contratistasFaena=function(a){f(a)},a.addContratista=function(b){c.guardarContratista({id:a.contrato.id,faena:a.faenaActual,tag:b})},a.removeContratista=function(b){c.borrarContratista({id:a.contrato.id,faena:a.faenaActual,empresa:b.id})},a.buscarEmpresas=function(a){return d.get(window.URL+"/empresa/buscar?type=tag&texto="+a)}}]),angular.module("seedApp").service("Toast",["notificationService",function(a){return{success:function(b,c){a.notifyWithDefaults({title:b,text:c,type:"success"})},error:function(b,c){c="Ocurrió un error",a.notifyWithDefaults({title:c,text:b,type:"error"})}}}]),angular.module("seedApp").controller("RequisitosevaluacionCtrl",["$scope","$stateParams","Trabajador","Evaluacion","Requisito","Estadorequisito","$http","$state","Toast","Upload","notificationService",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){var c=a.requisitosEvaluacion[b];console.log(c),d.borrarRequisito({id:a.evaluacion.id,idRequisito:c.requisito})}b.id?a.evaluacion=d.get({id:b.id},function(){console.log(a.evaluacion.trabajador.fecha_nacimiento);var b=new Date(a.evaluacion.trabajador.fecha_nacimiento.split("/")[2],a.evaluacion.trabajador.fecha_nacimiento.split("/")[1],a.evaluacion.trabajador.fecha_nacimiento.split("/")[0]),c=new Date;a.evaluacion.trabajador.edad=c.getFullYear()-b.getFullYear(),a.requisitosEvaluacion=d.verRequisitos({id:a.evaluacion.id},function(){}),a.requisitos=e.query(),a.estadoRequisito=f.query()}):h.go("home.evaluaciones"),a.avatar={},a.agregarRequisito=function(){var b=new Date;a.requisitosEvaluacion.push({requisito:"1",estado:"1",archivoSeleccionado:!1,subido:!1,vigencia:b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()})},a.rutaBase=window.URL+"/",a.archivoSeleccionado=function(a,b,c){if(a[0]){var d=a[0];c.archivoSeleccionado=!0,c.nombreArchivo=d.name}},a.guardarRequisitos=function(){0!==a.requisitosEvaluacion.length&&async.each(a.requisitosEvaluacion,function(b){b.upload=j.upload({url:window.URL+"/evaluacion/"+a.evaluacion.id+"/requisitos",fields:{requisito:b},file:b.archivo}),b.upload.progress(function(a){b.subiendo=!0,b.progreso=Math.min(100,parseInt(100*a.loaded/a.total)),b.width=b.progreso+"%"}),b.upload.success(function(){b.subiendo=!1,b.cargado=!0})},function(){console.log("error")})},a.borrarRequisito=function(a){k.notifyWithDefaults({title:"¿Borrar el requisito seleccionado?",text:"¿Esta seguro que desea borrar el requisito seleccionado?",type:"error",confirm:{confirm:!0,buttons:[{text:"OK",click:function(b,c){b.remove(),b.get().trigger("pnotify.confirm",[b,c]),console.log(a),l(a)}}]}})},a.guardarEvaluacion=function(){console.log(a.evaluacion),a.evaluacion.$update({step:"2"},function(a){a?(i.success("Datos guardados","Los datos fueron guardados correctamente"),h.go("home.habilitacionesEvaluacion",{id:a[0]})):i.error("Ocurrio un error al guardar. Intentelo de nuevo.")})},a.subirAvatar=function(b){0!==b.length&&(a.avatar.upload=j.upload({url:window.URL+"/trabajador/"+a.evaluacion.trabajador.id+"/avatar",file:b[0]}),a.avatar.upload.progress(function(){a.avatar.subiendo=!0}),a.avatar.upload.success(function(b){a.avatar.subiendo=!1;var c=(new Date).toString();a.evaluacion.trabajador.imagen=b.imagen+"?cb="+c}))}}]),angular.module("seedApp").service("Requisito",["$resource",function(a){return a(window.URL+"/requisito/:id",{id:"@id"},{query:{method:"GET",isArray:!0}})}]),angular.module("seedApp").service("Estadorequisito",["$resource",function(a){return a(window.URL+"/estado_requisito/:id",{id:"@id"},{query:{method:"GET",isArray:!0}})}]),angular.module("seedApp").controller("HabilitacionesevaluacionCtrl",["$scope","$stateParams","Trabajador","Evaluacion","Requisito","Estadorequisito","$http","$state","Toast","Upload","notificationService","Habilidad","Habilitacion",function(a,b,c,d,e,f,g,h){b.id?a.evaluacion=d.get({id:b.id},function(){var b=new Date(a.evaluacion.trabajador.fecha_nacimiento.split("/")[2],a.evaluacion.trabajador.fecha_nacimiento.split("/")[1],a.evaluacion.trabajador.fecha_nacimiento.split("/")[0]),c=new Date;a.evaluacion.trabajador.edad=c.getFullYear()-b.getFullYear(),a.requisitosEvaluacion=d.verRequisitos({id:a.evaluacion.id},function(){}),a.habilitaciones=d.verHabilitaciones({id:a.evaluacion.id}),a.restricciones=d.verRestricciones({id:a.evaluacion.id})}):h.go("home.evaluaciones"),a.rutaBase=window.URL+"/adjuntos/trabajadores/",a.buscarHabilidades=function(a){return g.get(window.URL+"/habilidad/buscar?texto="+a)},a.addHabilitacion=function(b){d.guardarHabilitacion({id:a.evaluacion.id,habilitado:!0,habilidad_id:b.id},function(a){b.id=a.id,b.habilidad_id=a.habilidad_id})},a.removeHabilitacion=function(b){d.borrarHabilitacion({id:a.evaluacion.id,idHabilitacion:b.id},function(a){console.log(a)})},a.addRestriccion=function(b){d.guardarHabilitacion({id:a.evaluacion.id,habilitado:!1,habilidad_id:b.id},function(a){b.id=a.id,b.habilidad_id=a.habilidad_id})},a.removeRestriccion=function(b){d.borrarHabilitacion({id:a.evaluacion.id,idHabilitacion:b.id},function(a){console.log(a)})}}]),angular.module("seedApp").service("Habilidad",["$resource",function(a){return a(window.URL+"/habilidad/:id",{id:"@id"},{query:{method:"GET",isArray:!0}})}]),angular.module("seedApp").service("Habilitacion",["$resource",function(a){return a(window.URL+"/habilitacion/:id",{id:"@id"},{query:{method:"GET",isArray:!0},save:{method:"POST",isArray:!1},remove:{method:"DELETE",url:window.URL+"/habilitacion/habilidad_evaluacion"}})}]),angular.module("seedApp").controller("ResumenCtrl",["$scope","$stateParams","Trabajador","Evaluacion","Requisito","Estadorequisito","$state","Toast","Habilidad","Habilitacion","Role",function(a,b,c,d,e,f,g){b.id?a.evaluacion=d.get({id:b.id},function(){var b=new Date(a.evaluacion.trabajador.fecha_nacimiento.split("/")[2],a.evaluacion.trabajador.fecha_nacimiento.split("/")[1],a.evaluacion.trabajador.fecha_nacimiento.split("/")[0]),c=new Date;a.evaluacion.fechaVigencia=new Date(a.evaluacion.fecha_vigencia.split("/")[2],a.evaluacion.fecha_vigencia.split("/")[1]-1,a.evaluacion.fecha_vigencia.split("/")[0]),console.log(a.evaluacion.fecha_evaluacion),a.evaluacion.fechaEvaluacion=new Date(a.evaluacion.fecha_evaluacion.split("/")[2],a.evaluacion.fecha_evaluacion.split("/")[1]-1,a.evaluacion.fecha_evaluacion.split("/")[0]),a.evaluacion.trabajador.edad=c.getFullYear()-b.getFullYear(),a.requisitosEvaluacion=d.verRequisitos({id:a.evaluacion.id,type:"resumen"},function(){}),a.habilitaciones=d.verTodasHabilitaciones({id:a.evaluacion.id,type:"resumen"})}):g.go("home.evaluaciones"),a.rutaDocumentos=window.URL,a.rutaBase=window.URL+"/adjuntos/trabajadores/",a.currentTab="home"}]);